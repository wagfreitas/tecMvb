<ion-header>
  <ion-toolbar>
    <ion-title>Calculadora de Serviço</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <form (ngSubmit)="manager(custosForm.value)" [formGroup]="custosForm">
    <div class="form-body">
      <ion-grid>
        <ion-row>
          <ion-col size="8">
            <h5>
              <ion-icon name="hammer-outline"></ion-icon>    Materiais Utilizados
            </h5>
          </ion-col>
          <ion-col size="4">
            <ion-icon (click)="openMaterialList()" name="add-circle-outline">
            </ion-icon>
          </ion-col>
        </ion-row>
      </ion-grid>

      <div *ngIf="openMaterial" formArrayName="materiais">
        <div [formGroupName]="m"
             *ngFor="let item of custosForm.get('materiais')['controls']; let m = index">
          <ion-grid>
            <ion-row class="ion-justify-content-left">
              <ion-col size="7">
                <div class="form-group">
                  <ion-item class="form-control">
                    <ion-select formControlName="nomeMaterial"
                                placeholder="Material"
                                position="stacked">
                      <ion-select-option [value]="item.tipo"
                                         *ngFor="let item of arrayMaterial">
                        {{item.tipo}}
                      </ion-select-option>
                    </ion-select>
                    <small *ngIf="submitted && f.examesposicao.invalid"
                    class="invalid-feedback">
               <div>Dê um valor para a posição criada</div>
             </small>
                  </ion-item>
                </div>
              </ion-col>
              <ion-col size="3">
                <ion-item>
                  <ion-input class="form-control"
                             formControlName="qtdeMaterial"
                             id="quantidade"
                             placeholder="Qtde"
                             type="text">
                  </ion-input>
                  <small *ngIf="submitted" class="invalid-feedback"></small>
                </ion-item>
              </ion-col>
              <ion-col size="1">
                <ion-icon (click)="addMaterial(m)" name="add-circle"></ion-icon>
              </ion-col>
              <ion-col size="1">
                <ion-icon (click)="removeMaterial(m)"
                          *ngIf="m > 0"
                          name="remove-circle">
                </ion-icon>
              </ion-col>
            </ion-row>
          </ion-grid>
        </div>
      </div>

      <ion-grid>
        <ion-row>
          <ion-col size="8">
            <h5>
              <ion-icon name="time-outline"></ion-icon>    Hora de Profissionais
            </h5>
          </ion-col>
          <ion-col size="4">
            <ion-icon (click)="openHorasList()" name="add-circle-outline">
            </ion-icon>
          </ion-col>
        </ion-row>
      </ion-grid>

      <div *ngIf="openHoras" formArrayName="horas">
        <div [formGroupName]="h"
             *ngFor="let item of custosForm.get('horas')['controls'];
          let h = index">
          <ion-grid>
            <ion-row class="ion-justify-content-left">
              <ion-col size="7">
                <div class="form-group">
                  <ion-item class="form-control" lines="none">
                    <ion-select formControlName="tipoHoras" placeholder="Horas">
                      <ion-select-option [value]="item.tipo"
                                         *ngFor="let item of arrayHoras">
                        {{item.tipo}}
                      </ion-select-option>
                    </ion-select>
                  </ion-item>
                </div>
              </ion-col>
              <ion-col size="3">
                <ion-item>
                  <ion-input class="form-control"
                             formControlName="qtdeHoras"
                             id="quantidade"
                             placeholder="Qtde"
                             type="text">
                  </ion-input>
                  <small *ngIf="submitted" class="invalid-feedback"></small>
                </ion-item>
              </ion-col>
              <ion-col size="1">
                <ion-icon (click)="addHoras(h)" name="add-circle"></ion-icon>
              </ion-col>
              <ion-col size="1">
                <ion-icon (click)="removeHoras(h)"
                          *ngIf="h > 0"
                          name="remove-circle">
                </ion-icon>
              </ion-col>
            </ion-row>

            <ion-row></ion-row>
          </ion-grid>
        </div>
      </div>

      <ion-grid>
        <ion-row>
          <ion-col size="8">
            <h5>
              <ion-icon name="car-sport-outline"></ion-icon>    Deslocamentos
            </h5>
          </ion-col>
          <ion-col size="4">
            <ion-icon (click)="openDeslocamentoList()"
                      name="add-circle-outline">
            </ion-icon>
          </ion-col>
        </ion-row>
      </ion-grid>

      <div *ngIf="openDeslocamentos" formArrayName="deslocamentos">
        <div [formGroupName]="d"
             *ngFor="let item of custosForm.get('deslocamentos')['controls'];
          let d = index">
          <ion-grid>
            <ion-row class="ion-justify-content-left">
              <ion-col size="7">
                <div class="form-group">
                  <ion-item class="form-control" lines="none">
                    <ion-select formControlName="tipoDeslocamento"
                                placeholder="Tipo">
                      <ion-select-option [value]="item.tipo"
                                         *ngFor="let item of arrayDeslocamento">
                        {{item.tipo}}
                      </ion-select-option>
                    </ion-select>
                  </ion-item>
                </div>
              </ion-col>
              <ion-col size="3">
                <ion-item>
                  <ion-input class="form-control"
                             formControlName="distancia"
                             id="quantidade"
                             placeholder="KMs"
                             type="text">
                  </ion-input>
                  <small *ngIf="submitted" class="invalid-feedback"></small>
                </ion-item>
              </ion-col>
              <ion-col size="1">
                <ion-icon (click)="addDeslocamento(d)" name="add-circle">
                </ion-icon>
              </ion-col>
              <ion-col size="1">
                <ion-icon (click)="removeDeslocamento(d)"
                          *ngIf="d>0"
                          name="remove-circle">
                </ion-icon>
              </ion-col>
            </ion-row>

            <ion-row></ion-row>
          </ion-grid>
        </div>
      </div>
       <ion-button  expand="full" type="submit"  *ngIf="confirma" > <ion-icon name="checkmark" ></ion-icon>   Confirma</ion-button>
       <ion-button  expand="full" type="submit" *ngIf="!confirma"> <ion-icon name="checkmark" ></ion-icon>   Editar</ion-button>
       <ion-button  expand="full" type="button" (click)="gravar()" *ngIf="!confirma" color="secondary"> <ion-icon name="checkmark" ></ion-icon>   Gravar</ion-button>
    </div>
  </form>

  <div class="container">
    <div class="item"> Total dos Materiais: {{valorMateriais | currency}}</div>
    <div class="item"> Total dos Deslocamentos: {{valorDeslocamentos | currency}}</div>
    <div class="item"> Total das Horas Trabalhadas: {{valorHoras | currency}}</div>
    <div class="item"> Total dos Serviços: {{ValorTotal | currency}}</div>

  </div>
</ion-content>
